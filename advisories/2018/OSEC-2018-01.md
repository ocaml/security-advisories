```
id: OSEC-2018-01
modified: "2025-12-16T12:00:00Z"
published: "2018-04-06T18:29:00.207Z"
aliases: [ CVE-2018-9838 ]
severity: "CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
severity_score: "9.8 (Critical)"
affected: "ocaml" {< "4.07.0"}
events: [
  git "git+https://github.com/ocaml/ocaml" [
    [fixed "9664c7ee807c2dfa802f53cabd405ff58e219c47"]
  ]
]
references: [
  [report "https://github.com/ocaml/ocaml/issues/7765"]
  [fix "https://github.com/ocaml/ocaml/pull/1718"]
]
credits: [
  [reporter "Maximilian Tschirschnitz" [ "mailto:maximilian.tschirschnitz@gmx.de" ]]
  [reporter "Philipp Hagenlocher" [ "mailto:philipp.hagenlocher@tum.de" ]]
  [remediation_developer "Xavier Leroy"]
  [remediation_reviewer "Gabriel Scherer"]
]
```

# An integer overflow in the `bigarray` serialization module leads to arbitrary code execution

## Bug description

The bigarray module in all recent ocaml versions is capable of reading in serialized (marshalled) objects from a external source which is often used for network operations and interprocess communication.

byterun/bigarray.c

Line 458 in ea60609
```C
 b->data = malloc(elt_size * num_elts);
```

A integer overflow vulnerability allows under certain circumstances an remote attacker to input a corrupt object and edit arbitrary addresses in the processes memory which leads over common techniques (in this take libc one gadget but any rop gadget or got table vector would work) to arbitrary memory access (!) and in the course also arbitrary code execution

Please check the writeup.pdf for more details !!

In variations of this the exploit is usable in all ocaml versions we tested no matter if compiled to binary or intepreted (!)

## Steps to reproduce

Check out the attached archive and run the makefile (or use the precompile executable)
the exploit can be run by executing exploit.py (python2.7 and pwntools are required)
The last step of code execution is using a one-gadget attack technique and is specific to the glibc version in use (e.g. tested is debian glibc 2.24-11+deb9u1) but can with minimal amount of work be ported to any libc version on any patch level to our knowledge

Of course you can also use the exploit.py to write your own version of exploit

## Additional information

This Vulnerability in ocaml was discovered by me (maximilian.tschirschnitz@gmx.de) and the exploit collaboratly developed with (philipp.hagenlocher@tum.de)
For illustration purposes it was packaged as security challenge to demonstrate the impact of the issue (see writeup.pdf)
